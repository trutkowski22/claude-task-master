flowchart TB
    subgraph rulesImports["direct-functions_rules-Imports"]
        I1["IMPORT: enableSilentMode, FROM: /claude-task-master/scripts/modules/utils.js"]
        I2["IMPORT: disableSilentMode, FROM: /claude-task-master/scripts/modules/utils.js"]
        I3["IMPORT: convertAllRulesToProfileRules, FROM: /claude-task-master/src/utils/rule-transformer.js"]
        I4["IMPORT: removeProfileRules, FROM: /claude-task-master/src/utils/rule-transformer.js"]
        I5["IMPORT: getRulesProfile, FROM: /claude-task-master/src/utils/rule-transformer.js"]
        I6["IMPORT: isValidProfile, FROM: /claude-task-master/src/utils/rule-transformer.js"]
        I7["IMPORT: RULE_PROFILES, FROM: /claude-task-master/src/constants/profiles.js"]
        I8["IMPORT: RULES_ACTIONS, FROM: /claude-task-master/src/constants/rules-actions.js"]
        I9["IMPORT: wouldRemovalLeaveNoProfiles, FROM: /claude-task-master/src/utils/profiles.js"]
        I10["IMPORT: getInstalledProfiles, FROM: /claude-task-master/src/utils/profiles.js"]
        I11["IMPORT: path, FROM: path"]
        I12["IMPORT: fs, FROM: fs"]
    end
    
    subgraph rulesDependencies["direct-functions_rules-Dependencies"]
        D1["DEP: FastMCP"]
        D2["DEP: File system"]
        D3["DEP: Rule management system"]
    end
    
    subgraph rulesFunctionsDefined["direct-functions_rules-Functions Defined"]
        FU1["FUNCTION: rulesDirect"]
    end
    
    subgraph rulesExports["direct-functions_rules-Exports"]
        E1["EXP: rulesDirect"]
    end
    
    subgraph rulesParameters["direct-functions_rules-Parameters"]
        P1["PARAM: {Object} args - Function arguments"]
        P2["PARAM: {string} args.action - Action to perform: add or remove rules"]
        P3["PARAM: {string[]} args.profiles - List of profiles to add or remove"]
        P4["PARAM: {string} args.projectRoot - Absolute path to the project root"]
        P5["PARAM: {boolean} args.yes - Run non-interactively (default true)"]
        P6["PARAM: {boolean} args.force - Force operation ignoring safety checks"]
        P7["PARAM: {Object} log - Logger object"]
        P8["PARAM: {Object} context - Additional context (session)"]
    end
    
    subgraph rulesConstants["direct-functions_rules-Const Declarations"]
        C1["CONST: action, VALUE: extracted from args"]
        C2["CONST: profiles, VALUE: extracted from args"]
        C3["CONST: projectRoot, VALUE: extracted from args"]
        C4["CONST: yes, VALUE: extracted from args"]
        C5["CONST: force, VALUE: extracted from args"]
        C6["CONST: removalResults, VALUE: empty array for removal operations"]
        C7["CONST: addResults, VALUE: empty array for add operations"]
        C8["CONST: installedProfiles, VALUE: getInstalledProfiles result"]
        C9["CONST: remainingProfiles, VALUE: filtered profiles after removal"]
        C10["CONST: profileConfig, VALUE: getRulesProfile result"]
        C11["CONST: result, VALUE: profile operation result"]
    end
    
    subgraph rulesExecutionFlow["direct-functions_rules-Execution Flow"]
        FL1["Enable silent mode to suppress console output"]
        FL2["Destructure and validate required arguments"]
        FL3["Initialize result arrays for removal and add operations"]
        FL4["Check if action is REMOVE and perform safety validations"]
        FL5["For each profile validate and execute removal operations"]
        FL6["Process removal results and generate summary"]
        FL7["Check if action is ADD and validate profiles"]
        FL8["For each profile execute add operations and file creation"]
        FL9["Process add results and generate summary"]
        FL10["Handle invalid action errors"]
        FL11["Disable silent mode and return results"]
        FL12["Handle errors and ensure silent mode is disabled in catch block"]
    end
    
    subgraph rules["direct-functions_rules.js"]
        rulesImports
        rulesDependencies
        rulesFunctionsDefined
        rulesExports
        rulesParameters
        rulesConstants
        rulesExecutionFlow
    end
    
    FL1 --> FL2
    FL2 --> FL3
    FL3 --> FL4
    FL4 --> FL5
    FL5 --> FL6
    FL6 --> FL7
    FL7 --> FL8
    FL8 --> FL9
    FL9 --> FL10
    FL10 --> FL11
    FL11 --> FL12